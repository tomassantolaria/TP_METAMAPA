<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head th:replace="~{layout/base :: head (title=${hecho.titulo})}"></head>
<body class="bg-pastel-blue-50 flex flex-col min-h-screen">

<div th:replace="~{layout/base :: header}"></div>

<main class="container mx-auto px-4 py-8 flex-grow">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md border border-pastel-blue-200">
        <a href="javascript:history.back()" class="text-sm text-pastel-blue-600 hover:underline">&larr; Volver</a>

        <h1 class="text-3xl font-bold text-pastel-blue-900 mt-4 mb-3" th:text="${hecho.titulo}">Título del Hecho</h1>
        <p class="text-gray-700 mb-6" th:text="${hecho.descripcion}">Descripción del hecho</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h2 class="text-xl font-semibold text-pastel-blue-800 mb-2">Detalles del Hecho</h2>
                <ul class="space-y-1 text-sm">
                    <li><strong>Categoría:</strong>
                        <span class="bg-pastel-blue-100 text-pastel-blue-800 px-2 py-1 rounded-full text-xs font-semibold"
                              th:text="${hecho.categoria}"></span>
                    </li>
                    <li><strong>Fecha del Acontecimiento:</strong> <span th:text="${hecho.fechaAcontecimiento.toLocalDate()}"></span></li>
                    <li><strong>Fecha de Carga:</strong> <span th:text="${hecho.fechaCarga.toLocalDate()}"></span></li>
                    <li><strong>Origen:</strong> <span th:text="${hecho.origen_carga}"></span></li>
                </ul>
            </div>

            <div>
                <h2 class="text-xl font-semibold text-pastel-blue-800 mb-2">Ubicación</h2>
                <ul class="space-y-1 text-sm">
                    <li><strong>País:</strong> <span th:text="${hecho.pais}"></span></li>
                    <li><strong>Provincia:</strong> <span th:text="${hecho.provincia}"></span></li>
                    <li><strong>Localidad:</strong> <span th:text="${hecho.localidad}"></span></li>
                    <li th:if="${hecho.latitud != null and hecho.longitud != null}">
                        <strong>Coordenadas:</strong>
                        <span th:text="${hecho.latitud}"></span>,
                        <span th:text="${hecho.longitud}"></span>
                    </li>
                </ul>
            </div>
        </div>

        <div th:if="${hecho.contenido}" class="mt-8">
            <h2 class="text-xl font-semibold text-pastel-blue-800 mb-2">Contenido Adicional</h2>
            <p class="text-gray-700 whitespace-pre-wrap" th:text="${hecho.contenido}"></p>
            <div th:if="${hecho.contenido == null or hecho.contenido.isEmpty()}">
                <p class="text-gray-500 italic">No hay contenido adicional.</p>
            </div>
        </div>

        <div th:if="${hecho.contenido_multimedia}" class="mt-8">
            <h2 class="text-xl font-semibold text-pastel-blue-800 mb-2">Contenido Multimedia</h2>
            <img th:src="@{${hecho.contenido_multimedia}}" alt="Contenido multimedia"
                 class="rounded-lg border border-gray-300 shadow-md max-h-96 mx-auto"/>
        </div>

        <div class="mt-8">
            <div th:if="${hecho.origen_carga.equals(origenDinamica.name())}">
                <h2 class="text-xl font-semibold text-pastel-blue-800 mb-2">Contribuyente</h2>
                <p th:if="${hecho.anonimo}" class="italic text-gray-600">Este hecho fue reportado de forma anónima.</p>
                <p th:if="${!hecho.anonimo}" class="text-gray-700">
                    Reportado por: <strong th:text="${hecho.usuario}"></strong>
                </p>
            </div>
        </div>

        <div sec:authorize="!hasRole('admin_client_role')"  class="mt-8 pt-6 border-t border-pastel-blue-200 flex justify-end">
            <a th:href="@{/crearSolicitud(idHecho=${hecho.idHecho})}"
               class="inline-flex items-center gap-1.5 text-sm font-medium text-red-600 hover:text-red-900 hover:underline transition-colors">
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8.22 1.754a.75.75 0 011.56 0l.313 1.096A4.5 4.5 0 0013.9 5.86l1.04-.436a.75.75 0 01.976.516l.82 3.282a.75.75 0 01-.516.976l-1.04.436a4.5 4.5 0 00-3.013 3.013l.436 1.04a.75.75 0 01-.516.976l-3.282.82a.75.75 0 01-.976-.516l-.436-1.04a4.5 4.5 0 00-3.013-3.013l-1.04-.436a.75.75 0 01-.516-.976l.82-3.282a.75.75 0 01.976-.516l1.04.436A4.5 4.5 0 008.22 2.85l.313-1.096zM10 7.5a2.5 2.5 0 100 5 2.5 2.5 0 000-5z" clip-rule="evenodd" />
                </svg>
                Solicitar Eliminación
            </a>
        </div>


        <div th:if="${hecho.latitud != null and hecho.longitud != null}" class="mt-10">
            <h2 class="text-xl font-semibold text-pastel-blue-800 mb-3">Ubicación en el mapa</h2>
            <div id="map" class="h-96 rounded-md border border-gray-300"></div>
        </div>
    </div>
</main>

<div th:replace="~{layout/base :: footer}"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const lat = /*[[${hecho.latitud}]]*/ null;
    const lon = /*[[${hecho.longitud}]]*/ null;
    const localidad = /*[[${hecho.localidad}]]*/ 'Ubicación';

    if (lat && lon) {
        const map = L.map('map').setView([lat, lon], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        L.marker([lat, lon]).addTo(map)
            .bindPopup(localidad)
            .openPopup();
    }
    /*]]>*/
</script>

<div th:replace="~{layout/base :: scripts}"></div>
</body>
</html>