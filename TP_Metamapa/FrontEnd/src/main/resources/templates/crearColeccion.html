<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/base :: head (title='Crear Colección')}"></head>
<body class="bg-pastel-blue-50 flex flex-col min-h-screen transition-colors duration-300 dark:bg-gray-900 dark:text-white">
<div th:replace="~{layout/base :: header}"></div>

<main class="container mx-auto px-6 py-8 flex-grow">
    <div class="max-w-3xl mx-auto bg-white p-6 rounded-lg shadow-md border border-pastel-blue-200 dark:bg-gray-800 dark:border-gray-700">
        <h1 class="text-3xl font-bold text-pastel-blue-900 mb-6 dark:text-white">Crear Colección</h1>

        <form class="space-y-4" th:action="@{/admin/crear-coleccion}" th:object="${coleccionForm}" method="POST">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Título</label>
                <input type="text" th:field="*{titulo}" required class="mt-1 block w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
            </div>

            <fieldset class="border-t border-gray-200 pt-5 dark:border-gray-700">
                <legend class="text-base font-medium text-gray-900 mb-2 dark:text-white">Criterio de Pertenencia</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium dark:text-gray-300">País</label>
                        <input type="text" th:field="*{criterio.pais}" class="mt-1 block w-full border border-gray-300 rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                    </div>
                </div>
            </fieldset>

            <div class="flex justify-end items-center gap-4 pt-4">
                <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-md">Crear Colección</button>
            </div>
        </form>
    </div>
</main>

<div th:replace="~{layout/base :: footer}"></div>

    <script>
        // Mostrar campo de categoría personalizada
        const categoriaSelect = document.getElementById('categoria');
        const customDiv = document.getElementById('customCategoriaDiv');
        if(categoriaSelect && customDiv) {
            categoriaSelect.addEventListener('change', () => {
                if(categoriaSelect.value === 'Otra') customDiv.classList.remove('hidden');
                else customDiv.classList.add('hidden');
            });
        }

        // Búsqueda y autocompletado de país, provincia y localidad (sin mapa)
        const buscarBtn = document.getElementById("buscarUbicacion");
        const inputBuscar = document.getElementById("searchDireccion");

        if(buscarBtn) {
            buscarBtn.addEventListener("click", async () => {
                const query = inputBuscar.value.trim();
                if (!query) return alert("Por favor ingrese una dirección o ciudad para buscar.");

                try {
                    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
                    const data = await res.json();

                    if (data.length === 0) {
                        alert("No se encontró la ubicación especificada.");
                        return;
                    }

                    // Tomamos el primer resultado
                    const { lat, lon } = data[0];

                    // Reverse geocoding para completar campos
                    const reverseRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                    const reverseData = await reverseRes.json();
                    const address = reverseData.address || {};

                    document.getElementById('localidad').value = address.city || address.town || address.village || '';
                    document.getElementById('provincia').value = address.state || '';
                    document.getElementById('pais').value = address.country || '';

                } catch (err) {
                    console.error("Error en la búsqueda:", err);
                    alert("Ocurrió un error al buscar la dirección.");
                }
            });
        }
    </script>
<div th:replace="~{layout/base :: scripts}"></div>
</body>
</html>